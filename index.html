<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive 3D simulation of Uranus and its moons with advanced physics">
    <meta name="keywords" content="Uranus, astronomy, physics, simulation, moons, rings, gravity">
    <meta name="author" content="Uranus Simulation">
    
    <title>Uranus System - Advanced Physics Simulation</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⛢</text></svg>">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/ui-panels.css">
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Additional styles for physics features -->
    <style>
        /* Physics Engine Styles */
        .physics-banner {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.9), rgba(79, 208, 231, 0.9));
            padding: 12px 24px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .physics-banner:hover {
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 30px rgba(79, 208, 231, 0.4);
        }
        
        .physics-toggle-main {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .physics-toggle-main input[type="checkbox"] {
            width: 0;
            height: 0;
            opacity: 0;
            position: absolute;
        }
        
        .physics-toggle-main .toggle-slider {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            position: relative;
            transition: background 0.3s;
        }
        
        .physics-toggle-main .toggle-slider::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .physics-toggle-main input:checked + .toggle-slider {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .physics-toggle-main input:checked + .toggle-slider::after {
            transform: translateX(24px);
        }
        
        .physics-toggle-main span {
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .physics-status {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            font-size: 11px;
            color: white;
        }
        
        .physics-status .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 2s infinite;
        }
        
        .physics-status.active .status-dot {
            background: #44ff44;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Experiment Buttons */
        .experiment-buttons {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .experiment-btn {
            background: rgba(0, 20, 40, 0.9);
            border: 1px solid rgba(79, 208, 231, 0.3);
            color: #4FD0E7;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .experiment-btn:hover {
            background: rgba(79, 208, 231, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 208, 231, 0.3);
        }
        
        .experiment-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Physics Indicators */
        .physics-indicators {
            position: absolute;
            top: 80px;
            right: 10px;
            background: rgba(0, 20, 40, 0.9);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(79, 208, 231, 0.3);
            font-size: 11px;
            color: #6FE5F5;
            display: none;
        }
        
        .physics-indicators.visible {
            display: block;
        }
        
        .indicator-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }
        
        .indicator-item .label {
            color: #b0d0e0;
        }
        
        .indicator-item .value {
            color: #4FD0E7;
            font-weight: bold;
        }
        
        /* Enhanced Quick Toggle */
        .quick-toggle {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            background: rgba(0, 20, 40, 0.8);
            border-radius: 5px;
            padding: 5px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border: 1px solid rgba(79, 208, 231, 0.3);
            z-index: 100;
        }
        
        .quick-toggle .separator {
            height: 1px;
            background: rgba(79, 208, 231, 0.3);
            margin: 2px 0;
        }
        
        #quickPhysics {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.3), rgba(79, 208, 231, 0.3));
        }
        
        #quickPhysics.active {
            background: linear-gradient(135deg, rgba(255, 107, 157, 0.6), rgba(79, 208, 231, 0.6));
            animation: physicsGlow 2s infinite;
        }
        
        @keyframes physicsGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 107, 157, 0.5); }
            50% { box-shadow: 0 0 15px rgba(79, 208, 231, 0.8); }
        }
        
        /* Tutorial Overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .tutorial-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0, 20, 40, 0.95), rgba(20, 40, 60, 0.95));
            padding: 30px;
            border-radius: 15px;
            border: 2px solid rgba(79, 208, 231, 0.5);
            max-width: 500px;
            color: white;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .tutorial-content h2 {
            color: #4FD0E7;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .tutorial-content ul {
            list-style: none;
            padding: 0;
        }
        
        .tutorial-content li {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }
        
        .tutorial-content li::before {
            content: '✨';
            position: absolute;
            left: 0;
        }
        
        .tutorial-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #4FD0E7;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Loading enhancements */
        #loading .loading-content {
            text-align: center;
        }
        
        #loading .progress-bar {
            width: 200px;
            height: 4px;
            background: rgba(79, 208, 231, 0.2);
            border-radius: 2px;
            margin: 20px auto;
            overflow: hidden;
        }
        
        #loading .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4FD0E7, #ff6b9d);
            width: 0%;
            animation: loadProgress 3s ease-out forwards;
        }
        
        @keyframes loadProgress {
            to { width: 100%; }
        }
        
        /* Error message styles */
        .error-message {
            background: rgba(255, 100, 100, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .physics-banner {
                width: 90%;
                max-width: 300px;
                padding: 8px 16px;
                gap: 10px;
            }
            
            .physics-toggle-main span {
                font-size: 12px;
            }
            
            .experiment-buttons {
                flex-wrap: wrap;
                max-width: 90%;
            }
            
            .experiment-btn {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            .tutorial-content {
                width: 90%;
                max-width: none;
                margin: 20px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Main Canvas Container -->
    <div id="canvas-container"></div>
    
    <!-- Loading Screen -->
    <div id="loading">
        <div class="loading-content">
            <div>🌌 Initializing Uranus System...</div>
            <div class="spinner"></div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div style="font-size: 12px; margin-top: 10px; opacity: 0.7;">
                Loading 27 moons, 13 rings, and gravitational physics...
            </div>
        </div>
    </div>
    
    <!-- Physics Engine Banner -->
    <div class="physics-banner" id="physicsBanner">
        <label class="physics-toggle-main">
            <input type="checkbox" id="physicsMainToggle">
            <div class="toggle-slider"></div>
            <span>⚛️ Advanced Physics Engine</span>
        </label>
        <div class="physics-status" id="physicsStatus">
            <span class="status-dot"></span>
            <span id="physicsStatusText">Disabled</span>
        </div>
    </div>
    
    <!-- Information Panel -->
    <div id="info-panel" class="ui-panel minimized">
        <div class="panel-header">
            <div class="panel-title">
                <h1>⛢ URANUS</h1>
            </div>
            <div class="panel-controls">
                <button class="panel-btn minimize-btn">−</button>
            </div>
        </div>
        <div class="panel-content">
            <p><strong>The Tilted Ice Giant</strong></p>
            
            <h2>Physical Properties</h2>
            <p>Radius: 25,559 km (4× Earth)</p>
            <p>Mass: 14.5× Earth (8.681×10²⁵ kg)</p>
            <p>Rotation: 17.24 hours (retrograde)</p>
            <p>Axial Tilt: 97.77° (sideways!)</p>
            <p>Orbital Period: 84 Earth years</p>
            <p>Gravity: 8.87 m/s² (0.9× Earth)</p>
            
            <h2>Atmosphere</h2>
            <p>82.5% Hydrogen, 15.2% Helium</p>
            <p>2.3% Methane (creates blue color)</p>
            <p>Temperature: -224°C (coldest planet)</p>
            <p>Wind speeds: Up to 900 km/h</p>
            
            <h2>Ring System</h2>
            <p>• 13 rings discovered in 1977</p>
            <p>• ε (Epsilon) ring: brightest and densest</p>
            <p>• Extremely dark (2-5% reflectivity)</p>
            <p>• Particles: 20cm to 20m diameter</p>
            <p>• Shepherd moons: Cordelia & Ophelia</p>
            
            <h2>Moon System</h2>
            <p><strong>27 Known Moons:</strong></p>
            <p>• 5 Major: Miranda, Ariel, Umbriel, Titania, Oberon</p>
            <p>• 13 Inner: Including Puck, Cordelia, Ophelia</p>
            <p>• 9 Irregular: Retrograde & distant orbits</p>
            <p>All major moons are tidally locked</p>
            
            <h2>Unique Features</h2>
            <p>• Only planet rolling on its side</p>
            <p>• 42-year polar seasons</p>
            <p>• Magnetosphere offset by 1/3 radius</p>
            <p>• Magnetic field tilted 58.6° from axis</p>
            <p>• Possible subsurface oceans on large moons</p>
            
            <h2>Exploration</h2>
            <p>• Discovered: 1781 by William Herschel</p>
            <p>• Visited: Voyager 2 (1986)</p>
            <p>• Future: Proposed orbiter missions</p>
        </div>
    </div>
    
    <!-- Controls Panel -->
    <div id="controls-panel" class="ui-panel minimized">
        <div class="panel-header">
            <div class="panel-title">
                <h3>⚙ Controls</h3>
            </div>
            <div class="panel-controls">
                <button class="panel-btn minimize-btn">−</button>
            </div>
        </div>
        <div class="panel-content">
            <div class="control-group">
                <label>Time Speed:</label>
                <input type="range" id="timeSpeed" min="-2" max="3" value="0" step="0.1">
                <span id="timeSpeedValue">1 hour/sec</span>
            </div>
            
            <div class="control-group">
                <button class="control-button" id="pauseBtn">⏸ Pause</button>
                <button class="control-button" id="resetBtn">⟲ Reset View</button>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showRings" checked> Show Rings
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showMoons" checked> Show Moons
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showOrbits" checked> Show Orbits
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showMagnetosphere"> Magnetosphere
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showLabels" checked> Show Labels
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="showAxes"> Axis Helper
                </label>
            </div>
            
            <div class="control-group">
                <label>Distance Scale:</label>
                <input type="range" id="distanceScale" min="0.3" max="2" value="1" step="0.1">
                <span id="distanceValue">1.0x</span>
            </div>
            
            <div class="control-group">
                <label>Moon Size:</label>
                <input type="range" id="moonScale" min="1" max="5" value="2" step="0.5">
                <span id="moonSizeValue">2x</span>
            </div>
            
            <div class="control-group">
                <label>Ring Shine:</label>
                <input type="range" id="ringShine" min="0" max="1" value="0.7" step="0.1">
                <span id="ringShineValue">70%</span>
            </div>
        </div>
    </div>
    
    <!-- Stats Panel -->
    <div id="stats-panel" class="ui-panel">
        <div class="panel-header">
            <div class="panel-title">
                <h3>📊 Stats</h3>
            </div>
            <div class="panel-controls">
                <button class="panel-btn minimize-btn">−</button>
            </div>
        </div>
        <div class="panel-content">
            <div class="stat-line">
                <span>FPS:</span>
                <span id="fps">60</span>
            </div>
            <div class="stat-line">
                <span>Sim Time:</span>
                <span id="simDay">0d</span>
            </div>
            <div class="stat-line">
                <span>Rotation:</span>
                <span id="rotation">0°</span>
            </div>
            <div class="stat-line">
                <span>Year Progress:</span>
                <span id="yearProgress">0%</span>
            </div>
        </div>
    </div>
    
    <!-- Physics Indicators -->
    <div id="physics-indicators" class="physics-indicators">
        <div class="indicator-item">
            <span class="label">Physics:</span>
            <span class="value" id="physicsMode">OFF</span>
        </div>
        <div class="indicator-item">
            <span class="label">Bodies:</span>
            <span class="value" id="bodyCount">28</span>
        </div>
        <div class="indicator-item">
            <span class="label">Method:</span>
            <span class="value" id="integrationMethod">Kepler</span>
        </div>
        <div class="indicator-item">
            <span class="label">Resonances:</span>
            <span class="value" id="resonanceCount">12</span>
        </div>
    </div>
    
    <!-- Coordinates Panel -->
    <div id="coordinates-panel">
        <div><strong>Camera Position</strong></div>
        <div>X: <span id="camX">0</span></div>
        <div>Y: <span id="camY">0</span></div>
        <div>Z: <span id="camZ">0</span></div>
        <div>Distance: <span id="camDist">0</span></div>
        <div>Azimuth: <span id="camAzimuth">0</span>°</div>
        <div>Elevation: <span id="camElevation">0</span>°</div>
    </div>
    
    <!-- Enhanced Quick Toggle Buttons -->
    <div class="quick-toggle">
        <button id="quickRings" class="active" title="Toggle Rings">⭕</button>
        <button id="quickMoons" class="active" title="Toggle Moons">🌙</button>
        <button id="quickOrbits" class="active" title="Toggle Orbits">⚪</button>
        <button id="quickMag" title="Toggle Magnetosphere">🧲</button>
        <button id="quickLabels" class="active" title="Toggle Labels">📝</button>
        <button id="quickAxes" title="Toggle Axes">📐</button>
        <div class="separator"></div>
        <button id="quickPhysics" title="Toggle Advanced Physics">⚛️</button>
    </div>
    
    <!-- Experiment Buttons (Hidden by default, shown when physics enabled) -->
    <div class="experiment-buttons" id="experimentButtons" style="display: none;">
        <button class="experiment-btn" id="launchParticleBtn" title="Launch a test particle" disabled>
            🚀 Launch Particle
        </button>
        <button class="experiment-btn" id="showLagrangeBtn" title="Show Lagrange points" disabled>
            📍 L-Points
        </button>
        <button class="experiment-btn" id="showGravityBtn" title="Visualize gravity field" disabled>
            🌊 Gravity Field
        </button>
        <button class="experiment-btn" id="tidalStressBtn" title="Show tidal stress" disabled>
            💫 Tidal Stress
        </button>
    </div>
    
    <!-- Moon Info Tooltip -->
    <div id="moon-info">
        <h3 id="moon-name">Moon</h3>
        <p id="moon-details"></p>
        <p id="moon-position"></p>
    </div>
    
    <!-- Help Button -->
    <button id="help-button" title="Help & Tutorial">?</button>
    
    <!-- Axis Helper Legend -->
    <div class="axis-helper" style="display: none;">
        <span style="color: #ff0000;">X (Red)</span> |
        <span style="color: #00ff00;">Y (Green)</span> |
        <span style="color: #0080ff;">Z (Blue)</span>
    </div>
    
    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <button class="tutorial-close" id="tutorialClose">×</button>
            <h2>🌌 Welcome to Uranus System Simulation</h2>
            <ul>
                <li><strong>Navigation:</strong> Left-click & drag to rotate, scroll to zoom</li>
                <li><strong>Physics Engine:</strong> Toggle for enhanced orbital mechanics</li>
                <li><strong>27 Moons:</strong> All known moons with accurate orbits</li>
                <li><strong>Ring System:</strong> 13 rings including the bright ε ring</li>
                <li><strong>Time Control:</strong> Speed up, slow down, or reverse time</li>
                <li><strong>Magnetosphere:</strong> See the tilted magnetic field</li>
                <li><strong>Experiments:</strong> Various simulation tools (when physics is enabled)</li>
                <li><strong>Panels:</strong> Drag panel headers to move them around</li>
            </ul>
            <p style="text-align: center; margin-top: 20px;">
                <button class="control-button" onclick="document.getElementById('tutorialOverlay').style.display='none'">
                    Start Exploring
                </button>
            </p>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script type="module">
        // Global state management
        window.UranusSimulationState = {
            loaded: false,
            physicsEnabled: false,
            simulation: null,
            physicsEngine: null
        };
        
        // Error handling function
        function showError(message) {
            console.error('Uranus Simulation Error:', message);
            const loading = document.getElementById('loading');
            if (loading) {
                loading.innerHTML = `
                    <div class="loading-content">
                        <div class="error-message">
                            ⚠️ Error Loading Simulation<br>
                            ${message}<br>
                            <small>Check the browser console for details</small>
                        </div>
                        <button class="control-button" onclick="location.reload()">
                            Reload Page
                        </button>
                    </div>
                `;
            }
        }
        
        // Physics toggle handler
        function setupPhysicsToggle() {
            const physicsMainToggle = document.getElementById('physicsMainToggle');
            const statusEl = document.getElementById('physicsStatus');
            const statusText = document.getElementById('physicsStatusText');
            const indicators = document.getElementById('physics-indicators');
            const experiments = document.getElementById('experimentButtons');
            const quickPhysics = document.getElementById('quickPhysics');
            
            physicsMainToggle.addEventListener('change', (e) => {
                const isEnabled = e.target.checked;
                window.UranusSimulationState.physicsEnabled = isEnabled;
                
                if (isEnabled) {
                    statusEl.classList.add('active');
                    statusText.textContent = 'Enhanced Mode';
                    indicators.classList.add('visible');
                    experiments.style.display = 'flex';
                    quickPhysics.classList.add('active');
                    document.getElementById('physicsMode').textContent = 'ENHANCED';
                    document.getElementById('integrationMethod').textContent = 'RK4';
                    
                    // Enable experiment buttons (placeholder functionality)
                    document.querySelectorAll('.experiment-btn').forEach(btn => {
                        btn.disabled = false;
                    });
                    
                } else {
                    statusEl.classList.remove('active');
                    statusText.textContent = 'Disabled';
                    indicators.classList.remove('visible');
                    experiments.style.display = 'none';
                    quickPhysics.classList.remove('active');
                    document.getElementById('physicsMode').textContent = 'OFF';
                    document.getElementById('integrationMethod').textContent = 'Kepler';
                    
                    // Disable experiment buttons
                    document.querySelectorAll('.experiment-btn').forEach(btn => {
                        btn.disabled = true;
                    });
                }
            });
            
            // Quick physics toggle
            quickPhysics.addEventListener('click', () => {
                physicsMainToggle.checked = !physicsMainToggle.checked;
                physicsMainToggle.dispatchEvent(new Event('change'));
            });
        }
        
        // Setup experiment buttons
        function setupExperimentButtons() {
            // Placeholder implementations - these would connect to actual physics engine
            document.getElementById('launchParticleBtn')?.addEventListener('click', () => {
                console.log('Launch particle feature would be implemented here');
                // Could add a visual effect or show a message
                showMessage('🚀 Test particle launched! (Feature in development)');
            });
            
            document.getElementById('showLagrangeBtn')?.addEventListener('click', function() {
                this.classList.toggle('active');
                const isActive = this.classList.contains('active');
                console.log('Lagrange points:', isActive ? 'shown' : 'hidden');
                showMessage(isActive ? '📍 Lagrange points shown' : '📍 Lagrange points hidden');
            });
            
            document.getElementById('showGravityBtn')?.addEventListener('click', function() {
                this.classList.toggle('active');
                const isActive = this.classList.contains('active');
                console.log('Gravity field visualization:', isActive ? 'enabled' : 'disabled');
                showMessage(isActive ? '🌊 Gravity field visualization enabled' : '🌊 Gravity field visualization disabled');
            });
            
            document.getElementById('tidalStressBtn')?.addEventListener('click', function() {
                this.classList.toggle('active');
                const isActive = this.classList.contains('active');
                console.log('Tidal stress visualization:', isActive ? 'enabled' : 'disabled');
                showMessage(isActive ? '💫 Tidal stress visualization enabled' : '💫 Tidal stress visualization disabled');
            });
        }
        
        // Show temporary message
        function showMessage(text) {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(79, 208, 231, 0.9);
                color: white;
                padding: 10px 20px;
                border-radius: 20px;
                z-index: 1500;
                font-size: 14px;
                backdrop-filter: blur(10px);
                animation: slideIn 0.3s ease-out;
            `;
            msg.textContent = text;
            
            // Add animation keyframes
            if (!document.getElementById('messageAnimations')) {
                const style = document.createElement('style');
                style.id = 'messageAnimations';
                style.textContent = `
                    @keyframes slideIn {
                        from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                        to { opacity: 1; transform: translateX(-50%) translateY(0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(msg);
            setTimeout(() => {
                msg.style.opacity = '0';
                msg.style.transform = 'translateX(-50%) translateY(-20px)';
                setTimeout(() => msg.remove(), 300);
            }, 2000);
        }
        
        // Setup tutorial
        function setupTutorial() {
            const tutorialOverlay = document.getElementById('tutorialOverlay');
            const tutorialClose = document.getElementById('tutorialClose');
            const helpButton = document.getElementById('help-button');
            
            // Show tutorial on first visit
            if (!localStorage.getItem('uranusSimTutorialShown')) {
                setTimeout(() => {
                    tutorialOverlay.style.display = 'block';
                    localStorage.setItem('uranusSimTutorialShown', 'true');
                }, 3000);
            }
            
            // Tutorial close button
            tutorialClose.addEventListener('click', () => {
                tutorialOverlay.style.display = 'none';
            });
            
            // Help button shows tutorial
            helpButton.addEventListener('click', () => {
                tutorialOverlay.style.display = 'block';
            });
        }
        
        // Initialize all UI components
        function initializeUI() {
            setupPhysicsToggle();
            setupExperimentButtons();
            setupTutorial();
            
            console.log('UI components initialized');
        }
        
        // Initialize main simulation
        async function initializeSimulation() {
            try {
                console.log('🚀 Loading Uranus Simulation...');
                
                // Load main simulation module
                const mainModule = await import('./js/main.js');
                console.log('Main simulation module loaded');
                
                // Wait for simulation to be available
                let attempts = 0;
                const maxAttempts = 50;
                
                const waitForSimulation = () => {
                    return new Promise((resolve, reject) => {
                        const checkInterval = setInterval(() => {
                            attempts++;
                            
                            if (window.UranusSimulation && window.UranusSimulation.isInitialized) {
                                clearInterval(checkInterval);
                                resolve(window.UranusSimulation);
                            } else if (attempts >= maxAttempts) {
                                clearInterval(checkInterval);
                                reject(new Error('Simulation failed to initialize within timeout'));
                            }
                        }, 100);
                    });
                };
                
                const simulation = await waitForSimulation();
                window.UranusSimulationState.loaded = true;
                window.UranusSimulationState.simulation = simulation;
                
                console.log('✅ Uranus Simulation fully loaded!');
                
            } catch (error) {
                console.error('Failed to load simulation:', error);
                showError(`Failed to load simulation: ${error.message}`);
            }
        }
        
        // Main initialization
        async function initialize() {
            try {
                // Initialize UI components first
                initializeUI();
                
                // Load and initialize the simulation
                await initializeSimulation();
                
            } catch (error) {
                console.error('Initialization failed:', error);
                showError(error.message);
            }
        }
        
        // Start initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>
</body>
</html>
